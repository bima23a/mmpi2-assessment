<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>MMPI-2 Assessment Tool (Input Data)</title>
    <style>
        :root {
            --primary: #2180d4;
            --primary-dark: #1a5fa8;
            --bg-light: #f0f2f5;
            --text-dark: #2c3e50;
            --text-light: #7f8c8d;
            --border: #dfe6e9;
            --success: #27ae60;
            --error: #e74c3c;
            --warning: #f39c12;
            --white: #ffffff;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body { font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; background: var(--bg-light); color: var(--text-dark); line-height: 1.6; font-size: 15px; }

        .container { max-width: 1000px; margin: 0 auto; padding: 15px; }

        /* HEADER */
        header { background: var(--white); padding: 20px; border-radius: 12px; margin-bottom: 20px; box-shadow: 0 4px 6px rgba(0,0,0,0.03); border-left: 6px solid var(--primary); }
        header h1 { color: var(--primary); font-size: 22px; margin-bottom: 5px; }
        header p { color: var(--text-light); font-size: 13px; }

        /* TABS */
        .tabs { display: flex; gap: 5px; margin-bottom: 20px; background: #e1e8ed; padding: 5px; border-radius: 10px; overflow-x: auto; }
        .tab-btn { flex: 1; padding: 10px; border: none; background: transparent; cursor: pointer; font-size: 14px; font-weight: 600; color: var(--text-light); border-radius: 8px; transition: 0.2s; white-space: nowrap; }
        .tab-btn.active { background: var(--white); color: var(--primary); box-shadow: 0 2px 4px rgba(0,0,0,0.05); }

        /* CONTENT */
        .tab-content { display: none; background: var(--white); padding: 25px; border-radius: 12px; box-shadow: 0 4px 10px rgba(0,0,0,0.03); animation: fadeIn 0.3s ease; }
        .tab-content.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }

        /* FORMS */
        .form-row { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
        .form-group { margin-bottom: 15px; }
        label { display: block; font-weight: 600; margin-bottom: 6px; font-size: 13px; color: var(--text-dark); }
        input, select, textarea { width: 100%; padding: 12px; border: 1px solid var(--border); border-radius: 8px; font-size: 14px; transition: 0.2s; background: #fdfdfd; }
        input:focus, select:focus, textarea:focus { outline: none; border-color: var(--primary); background: var(--white); box-shadow: 0 0 0 3px rgba(33, 128, 212, 0.1); }

        /* QUESTIONS */
        .summary { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin-bottom: 20px; }
        .summary-card { background: #f8f9fa; padding: 15px; border-radius: 8px; text-align: center; border: 1px solid #eee; }
        .summary-card h3 { font-size: 11px; color: var(--text-light); text-transform: uppercase; margin-bottom: 5px; }
        .summary-card .value { font-size: 20px; font-weight: 700; color: var(--primary); }

        .progress-container { height: 6px; background: #eee; border-radius: 3px; margin: 20px 0; overflow: hidden; }
        .progress-bar { height: 100%; background: var(--primary); width: 0%; transition: width 0.3s ease; }

        .question-item { margin-bottom: 15px; padding: 15px; border: 1px solid var(--border); border-radius: 10px; background: #fff; display: flex; flex-direction: column; gap: 10px; }
        .q-header { display: flex; justify-content: space-between; align-items: center; }
        .q-num { font-size: 12px; font-weight: 700; background: #e3f2fd; color: var(--primary); padding: 2px 8px; border-radius: 4px; }
        .q-text { font-size: 16px; font-weight: 500; color: #2d3436; line-height: 1.4; }
        
        .answer-opts { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        .ans-btn { padding: 12px; border: 2px solid var(--border); border-radius: 8px; background: #fff; font-weight: 600; cursor: pointer; transition: 0.2s; font-size: 14px; display: flex; align-items: center; justify-content: center; gap: 8px; }
        .ans-btn:active { transform: scale(0.98); }
        
        .ans-btn.plus { color: var(--success); }
        .ans-btn.minus { color: var(--error); }
        
        .ans-btn.plus.selected { background: var(--success); border-color: var(--success); color: white; }
        .ans-btn.minus.selected { background: var(--error); border-color: var(--error); color: white; }

        /* PAGINATION */
        .pagination { display: flex; justify-content: space-between; align-items: center; margin-top: 30px; background: #f8f9fa; padding: 10px; border-radius: 8px; }
        
        /* BUTTONS */
        .btn { padding: 12px 20px; border: none; border-radius: 8px; cursor: pointer; font-weight: 600; font-size: 14px; transition: 0.2s; display: inline-flex; align-items: center; justify-content: center; gap: 8px; }
        .btn-primary { background: var(--primary); color: white; box-shadow: 0 4px 6px rgba(33, 128, 212, 0.2); }
        .btn-primary:hover { background: var(--primary-dark); transform: translateY(-2px); }
        .btn-secondary { background: white; color: var(--text-dark); border: 1px solid var(--border); }
        .btn-success { background: var(--success); color: white; }
        .btn-warning { background: var(--warning); color: white; }
        .full-width { width: 100%; }

        /* MESSAGES */
        .info-box { background: #e3f2fd; border-left: 4px solid var(--primary); padding: 15px; border-radius: 6px; font-size: 13px; margin-bottom: 20px; color: #444; }
        .toast { position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%); background: #333; color: white; padding: 10px 20px; border-radius: 30px; font-size: 13px; opacity: 0; pointer-events: none; transition: 0.3s; z-index: 999; }
        .toast.show { opacity: 1; bottom: 30px; }

        /* REVIEW TABLE */
        .review-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(60px, 1fr)); gap: 5px; max-height: 400px; overflow-y: auto; }
        .rev-item { padding: 5px; text-align: center; border: 1px solid #eee; border-radius: 4px; font-size: 11px; }
        .rev-item.filled { background: #e8f5e9; border-color: #c8e6c9; }
        .rev-item.empty { background: #ffebee; border-color: #ffcdd2; }

        /* RESPONSIVE */
        @media (max-width: 768px) {
            .form-row { grid-template-columns: 1fr; gap: 10px; }
            .container { padding: 10px; }
            .ans-btn { padding: 15px; font-size: 15px; } /* Tombol lebih besar di HP */
            .pagination { flex-direction: column; gap: 10px; }
            .pagination button { width: 100%; }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üìã MMPI-2 Assessment</h1>
            <p>Alat input jawaban 567 item</p>
        </header>

        <div class="tabs">
            <button class="tab-btn active" onclick="switchTab('biodata')">1. Biodata</button>
            <button class="tab-btn" onclick="switchTab('questions')">2. Pernyataan</button>
            <button class="tab-btn" onclick="switchTab('review')">3. Review</button>
            <button class="tab-btn" onclick="switchTab('scoring')">4. Selesai</button>
        </div>

        <div id="biodata" class="tab-content active">
            <div class="info-box">Mohon isi data diri responden dengan lengkap sebelum memulai tes.</div>
            
            <form id="biodataForm">
                <div class="form-group">
                    <label>Nama Lengkap</label>
                    <input type="text" id="nama" placeholder="Masukkan nama..." required>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label>Jenis Kelamin</label>
                        <select id="jk" required>
                            <option value="Laki-laki">Laki-laki</option>
                            <option value="Perempuan">Perempuan</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Tanggal Lahir</label>
                        <input type="date" id="ttl" onchange="hitungUmur()">
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label>Umur (Tahun)</label>
                        <input type="number" id="umur" placeholder="Otomatis" readonly style="background:#f0f0f0;">
                    </div>
                    <div class="form-group">
                        <label>Pendidikan</label>
                        <select id="pendidikan">
                            <option value="SMA">SMA/K</option>
                            <option value="D3">D3</option>
                            <option value="S1">S1</option>
                            <option value="S2">S2</option>
                            <option value="Lainnya">Lainnya</option>
                        </select>
                    </div>
                </div>

                <div class="form-group">
                    <label>Pekerjaan</label>
                    <input type="text" id="pekerjaan" placeholder="Pekerjaan saat ini...">
                </div>

                <div class="form-group">
                    <label>Alamat Domisili</label>
                    <textarea id="alamat" rows="2"></textarea>
                </div>

                <button type="button" class="btn btn-primary full-width" onclick="validateAndNext()">Lanjut ke Pernyataan ‚Üí</button>
            </form>
        </div>

        <div id="questions" class="tab-content">
            <div class="summary">
                <div class="summary-card">
                    <h3>Total</h3>
                    <div class="value">567</div>
                </div>
                <div class="summary-card">
                    <h3>Terjawab</h3>
                    <div class="value" id="countAnswered">0</div>
                </div>
                <div class="summary-card">
                    <h3>Sisa</h3>
                    <div class="value" id="countRemaining">567</div>
                </div>
            </div>

            <div class="progress-container">
                <div class="progress-bar" id="progressBar"></div>
            </div>

            <div id="qContainer">
                </div>

            <div class="pagination">
                <button class="btn btn-secondary" onclick="prevPage()" id="btnPrev">‚Üê Sebelumnya</button>
                <span style="font-size:13px; font-weight:600; color:#555;" id="pageIndicator">Halaman 1/12</span>
                <button class="btn btn-primary" onclick="nextPage()" id="btnNext">Selanjutnya ‚Üí</button>
            </div>
        </div>

        <div id="review" class="tab-content">
            <h3>Review Jawaban</h3>
            <p style="font-size:13px; color:#666; margin-bottom:15px;">Hijau = Terjawab, Merah = Kosong. Klik kotak untuk lompat ke soal tersebut.</p>
            
            <div class="review-grid" id="reviewGrid"></div>
            
            <div style="margin-top:20px; text-align:right;">
                 <button class="btn btn-warning" onclick="checkMissing()">Cek yang belum dijawab</button>
                 <button class="btn btn-primary" onclick="switchTab('scoring')">Selesai Review ‚Üí</button>
            </div>
        </div>

        <div id="scoring" class="tab-content">
            <div style="text-align:center; padding:30px 10px;">
                <div style="font-size:50px; margin-bottom:15px;">‚úÖ</div>
                <h2 style="color:var(--primary);">Pengisian Selesai!</h2>
                <p style="color:#666; margin-bottom:30px;">
                    Data telah siap diproses. Silakan unduh file data (.json) di bawah ini!
                </p>

                <button class="btn btn-success" style="padding:15px 30px; font-size:16px;" onclick="downloadJSON()">
                    üì• Download Data (.JSON)
                </button>
                
                <div style="margin-top:20px;">
                     <button class="btn btn-secondary" onclick="resetAll()">üîÑ Reset / Mulai Baru</button>
                </div>
            </div>
        </div>
    </div>

    <div id="toast" class="toast">Data tersimpan otomatis</div>

    <script>
        // --- DATA ---
        // (Truncated for brevity, but logically full list 1-567 is assumed here in real usage)
        const QUESTIONS_DB = [
            "Aku suka majalah teknik", "Nafsu makan-ku baik", "Aku bangun dengan rasa nyaman hampir setiap pagi",
            "Aku mengira aku dapat menyukai pekerjaan perpustakaan", "Aku mudah terbangun oleh suara berisik",
            "Ayah-ku seorang yang baik", "Aku senang membaca berita kejahatan di surat kabar",
            "Tangan dan kaki-ku biasanya terasa cukup hangat", "Kehidupan-ku sehari-hari terisi penuh dengan hal-hal yang menarik",
            "Aku sanggup bekerja sebagaimana biasanya", "Aku sering merasa ada yang menyumbat dalam tenggorokan-ku",
            "Kehidupan seks-ku cukup memuaskan", "Seseorang harus berusaha memahami mimpinya sebagai petunjuk",
            "Aku senang cerita detektif atau cerita yang misterius", "Aku bekerja dalam ketegangan yang sangat besar",
            "Sekali-sekali aku berpikir tentang hal-hal yang buruk", "Aku yakin bahwa hidup ini tidak adil",
            "Aku terganggu oleh serangan rasa mual dan muntah-muntah", "Bila aku melamar pekerjaan baru, aku ingin tahu siapa yang penting",
            "Aku jarang sekali terganggu sembelit", "Aku pernah ingin sekali lari dari rumah",
            "Aku merasa tidak seorang-pun yang mengerti akan diri-ku", "Pada waktu-waktu tertentu aku tertawa dan menangis tanpa kendali",
            "Ada kalanya aku di-masuki roh jahat", "Aku ingin menjadi penyanyi", "Aku rasa lebih baik aku tutup mulut bila dalam kesulitan",
            "Prinsip-ku adalah berusaha membalas orang yang berbuat salah", "Aku terganggu oleh penyakit lambung beberapa kali dalam seminggu",
            "Ada kalanya aku merasa ingin mengumpat", "Aku bermimpi buruk beberapa malam sekali", "Aku merasa sukar untuk memusatkan perhatian pada pekerjaan",
            "Aku pernah mengalami hal-hal yang aneh dan tidak masuk akal", "Aku jarang merisaukan kesehatan-ku", "Aku belum pernah mengalami kesulitan karena kelakuan seks-ku",
            "Dalam suatu masa muda, aku pernah melakukan pencurian kecil", "Aku batuk-batuk hampir setiap waktu", "Kadang-kadang aku ingin membanting barang-barang",
            "Aku pernah tidak dapat mengurus sesuatu berhari-hari atau berbulan-bulan", "Tidur-ku sering terganggu dan terbangun-bangun",
            "Aku sering merasa seluruh kepala-ku sakit", "Aku tidak selalu mengatakan yang benar", "Bila orang-orang tidak menghalangi, aku akan lebih sukses",
            "Sekarang aku lebih mampu mengambil keputusan daripada dahulu", "Sekali atau lebih dalam seminggu, aku tiba-tiba merasa panas",
            "Kesehatan-ku kurang lebih sama baiknya dengan kawan-kawan-ku", "Bila aku berpapasan teman sekolah, aku lebih suka menghindari mereka",
            "Aku hampir tidak pernah terganggu nyeri pada jantung atau dada", "Pada umumnya aku lebih suka duduk melamun daripada bekerja",
            "Aku seorang yang mudah bergaul", "Aku sering harus menerima perintah dari seseorang tidak lebih pandai"
            // ... (Insert full 567 questions here for production) ...
        ];
        
        // Dummy filler for demo purposes to reach 567 if list is short
        while(QUESTIONS_DB.length < 567) {
            QUESTIONS_DB.push(`Pernyataan simulasi nomor ${QUESTIONS_DB.length + 1} untuk testing.`);
        }

        let answers = {};
        let currentPage = 1;
        const perPage = 50;
        const totalPages = Math.ceil(567 / perPage);

        // --- INIT ---
        window.onload = function() {
            loadFromStorage();
            renderPage();
            updateStats();
        };

        // --- CORE FUNCTIONS ---

        function switchTab(tabId) {
            document.querySelectorAll('.tab-content').forEach(el => el.classList.remove('active'));
            document.querySelectorAll('.tab-btn').forEach(el => el.classList.remove('active'));
            
            document.getElementById(tabId).classList.add('active');
            
            // Highlight button matching onclick
            const btns = document.querySelectorAll('.tab-btn');
            btns.forEach(btn => {
                if(btn.getAttribute('onclick').includes(tabId)) btn.classList.add('active');
            });

            if(tabId === 'review') renderReviewGrid();
        }

        function validateAndNext() {
            const nama = document.getElementById('nama').value;
            const jk = document.getElementById('jk').value;
            const ttl = document.getElementById('ttl').value;

            if(!nama || !jk || !ttl) {
                alert("Mohon lengkapi Nama, Jenis Kelamin, dan Tanggal Lahir.");
                return;
            }
            saveToStorage();
            switchTab('questions');
        }

        function hitungUmur() {
            const ttl = document.getElementById('ttl').value;
            if(!ttl) return;
            const birthDate = new Date(ttl);
            const today = new Date();
            let age = today.getFullYear() - birthDate.getFullYear();
            const m = today.getMonth() - birthDate.getMonth();
            if (m < 0 || (m === 0 && today.getDate() < birthDate.getDate())) age--;
            document.getElementById('umur').value = age;
        }

        // --- QUESTION RENDERING ---

        function renderPage() {
            const container = document.getElementById('qContainer');
            container.innerHTML = '';
            
            const start = (currentPage - 1) * perPage;
            const end = Math.min(start + perPage, 567);

            for (let i = start; i < end; i++) {
                const qNum = i + 1;
                const qText = QUESTIONS_DB[i];
                const val = answers[qNum];

                const div = document.createElement('div');
                div.className = 'question-item';
                div.id = `q-${qNum}`;
                div.innerHTML = `
                    <div class="q-header">
                        <span class="q-num">#${qNum}</span>
                    </div>
                    <div class="q-text">${qText}</div>
                    <div class="answer-opts">
                        <div class="ans-btn plus ${val==='+' ? 'selected' : ''}" onclick="setAnswer(${qNum}, '+')">
                            <span>YA</span> <span>‚úÖ</span>
                        </div>
                        <div class="ans-btn minus ${val==='-' ? 'selected' : ''}" onclick="setAnswer(${qNum}, '-')">
                            <span>TIDAK</span> <span>‚ùå</span>
                        </div>
                    </div>
                `;
                container.appendChild(div);
            }

            document.getElementById('pageIndicator').innerText = `Halaman ${currentPage}/${totalPages}`;
            document.getElementById('btnPrev').disabled = (currentPage === 1);
            document.getElementById('btnNext').disabled = (currentPage === totalPages);
            
            // Scroll to top of questions
            if(document.getElementById('questions').classList.contains('active')) {
                document.querySelector('.summary').scrollIntoView({behavior: 'smooth'});
            }
        }

        function setAnswer(num, val) {
            answers[num] = val;
            
            // Update UI instant
            const card = document.getElementById(`q-${num}`);
            if(card) {
                const btns = card.querySelectorAll('.ans-btn');
                btns.forEach(b => b.classList.remove('selected'));
                if(val === '+') btns[0].classList.add('selected');
                else btns[1].classList.add('selected');
            }
            
            updateStats();
            saveToStorage();
        }

        function prevPage() { if(currentPage > 1) { currentPage--; renderPage(); } }
        function nextPage() { if(currentPage < totalPages) { currentPage++; renderPage(); } }
        
        function goToQuestion(num) {
            switchTab('questions');
            currentPage = Math.ceil(num / perPage);
            renderPage();
            // Wait render then scroll
            setTimeout(() => {
                const el = document.getElementById(`q-${num}`);
                if(el) {
                    el.scrollIntoView({behavior: 'smooth', block: 'center'});
                    el.style.border = "2px solid var(--warning)";
                    setTimeout(() => el.style.border = "1px solid var(--border)", 2000);
                }
            }, 100);
        }

        // --- STATS & REVIEW ---

        function updateStats() {
            const count = Object.keys(answers).length;
            const pct = (count / 567) * 100;
            
            document.getElementById('countAnswered').innerText = count;
            document.getElementById('countRemaining').innerText = 567 - count;
            document.getElementById('progressBar').style.width = `${pct}%`;
        }

        function renderReviewGrid() {
            const grid = document.getElementById('reviewGrid');
            grid.innerHTML = '';
            
            for(let i=1; i<=567; i++) {
                const div = document.createElement('div');
                const filled = answers[i] !== undefined;
                div.className = `rev-item ${filled ? 'filled' : 'empty'}`;
                div.innerText = i;
                div.onclick = () => goToQuestion(i);
                grid.appendChild(div);
            }
        }

        function checkMissing() {
            for(let i=1; i<=567; i++) {
                if(!answers[i]) {
                    alert(`Nomor ${i} belum dijawab. Mengarahkan ke soal...`);
                    goToQuestion(i);
                    return;
                }
            }
            alert("Semua soal sudah terjawab!");
        }

        // --- STORAGE & EXPORT ---

        function saveToStorage() {
            const data = {
                biodata: {
                    nama: document.getElementById('nama').value,
                    jk: document.getElementById('jk').value,
                    ttl: document.getElementById('ttl').value,
                    pendidikan: document.getElementById('pendidikan').value,
                    pekerjaan: document.getElementById('pekerjaan').value,
                    alamat: document.getElementById('alamat').value,
                    umur: document.getElementById('umur').value
                },
                answers: answers
            };
            localStorage.setItem('mmpi_data_v5', JSON.stringify(data));
            showToast();
        }

        function loadFromStorage() {
            const raw = localStorage.getItem('mmpi_data_v5');
            if(raw) {
                const data = JSON.parse(raw);
                answers = data.answers || {};
                
                if(data.biodata) {
                    document.getElementById('nama').value = data.biodata.nama || '';
                    document.getElementById('jk').value = data.biodata.jk || 'Laki-laki';
                    document.getElementById('ttl').value = data.biodata.ttl || '';
                    document.getElementById('pendidikan').value = data.biodata.pendidikan || 'SMA';
                    document.getElementById('pekerjaan').value = data.biodata.pekerjaan || '';
                    document.getElementById('alamat').value = data.biodata.alamat || '';
                    document.getElementById('umur').value = data.biodata.umur || '';
                }
            }
        }

        function showToast() {
            const t = document.getElementById('toast');
            t.classList.add('show');
            setTimeout(() => t.classList.remove('show'), 2000);
        }

        function resetAll() {
            if(confirm("Hapus semua data dan mulai dari awal?")) {
                localStorage.removeItem('mmpi_data_v5');
                location.reload();
            }
        }

        // --- KEY LOGIC: JSON DOWNLOAD ---
        function downloadJSON() {
            const nama = document.getElementById('nama').value.trim();
            if (!nama) {
                alert('‚ö†Ô∏è Isi nama di biodata dulu!');
                switchTab('biodata');
                return;
            }

            // 1. Convert Answers (+ -> true, - -> false)
            const cleanAnswers = {};
            for (let i = 1; i <= 567; i++) {
                const val = answers[i];
                // Hanya masukkan jika ada jawaban, biarkan undefined jika kosong (Cannot Say)
                if (val === '+') cleanAnswers[i] = true;
                else if (val === '-') cleanAnswers[i] = false;
            }

            // 2. Build Object sesuai format Scoring System
            const exportData = {
                biodata: {
                    nama: nama,
                    usia: parseInt(document.getElementById('umur').value) || 0,
                    jk: document.getElementById('jk').value, // 'Laki-laki' / 'Perempuan'
                    pendidikan: document.getElementById('pendidikan').value,
                    pekerjaan: document.getElementById('pekerjaan').value,
                    alamat: document.getElementById('alamat').value,
                    tanggal: new Date().toISOString().split('T')[0]
                },
                answers: cleanAnswers
            };

            // 3. Download Logic
            const dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(exportData, null, 2));
            const dlAnchor = document.createElement('a');
            const safeName = nama.replace(/[^a-zA-Z0-9]/g, '_');
            
            dlAnchor.setAttribute("href", dataStr);
            dlAnchor.setAttribute("download", `MMPI2_Input_${safeName}.json`);
            document.body.appendChild(dlAnchor);
            dlAnchor.click();
            dlAnchor.remove();
        }

    </script>
</body>
</html>
